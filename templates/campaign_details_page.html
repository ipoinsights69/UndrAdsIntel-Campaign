{% extends "new_layout.html" %}

{% block title %}Campaign Details - UndrApp Intel{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
    <div>
        <div class="flex items-center gap-2 mb-2">
            <a href="/" class="text-primary-600 hover:text-primary-800 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                Back to Dashboard
            </a>
        </div>
        <h1 class="text-3xl font-bold text-gray-800">Campaign #<span id="campaign-id"></span></h1>
        <div class="mt-2">
            <span id="campaign-status-badge" class="badge">Loading...</span>
        </div>
    </div>
    <button id="refresh-data" class="btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
        </svg>
        Refresh Data
    </button>
</div>

<!-- Campaign Overview -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    <!-- Campaign Status Card -->
    <div class="card">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Campaign Status</h2>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
            <!-- Total Apps -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-blue-400 to-blue-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Total Apps</p>
                    <p class="text-lg font-semibold text-gray-800" id="total-apps">0</p>
                </div>
            </div>
            
            <!-- Apps with Contacts -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-green-400 to-green-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Apps with Contacts</p>
                    <p class="text-lg font-semibold text-gray-800" id="apps-with-contacts">0</p>
                </div>
            </div>
            
            <!-- Emails Generated -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-purple-400 to-purple-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Emails Generated</p>
                    <p class="text-lg font-semibold text-gray-800" id="emails-generated">0</p>
                </div>
            </div>
            
            <!-- Emails Sent -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-orange-400 to-orange-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Emails Sent</p>
                    <p class="text-lg font-semibold text-gray-800" id="emails-sent">0</p>
                </div>
            </div>
        </div>
        
        <!-- Progress Bars -->
        <div class="space-y-4">
            <!-- Contact Extraction Progress -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">Contact Extraction</span>
                    <span class="text-sm font-medium text-gray-700" id="extraction-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-primary-600 h-2.5 rounded-full" id="extraction-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Email Generation Progress -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">Email Generation</span>
                    <span class="text-sm font-medium text-gray-700" id="generation-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-primary-600 h-2.5 rounded-full" id="generation-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Email Sending Progress -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">Email Sending</span>
                    <span class="text-sm font-medium text-gray-700" id="sending-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-primary-600 h-2.5 rounded-full" id="sending-progress" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="mt-4 text-sm text-gray-500 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            <span>Last updated: <span id="last-updated">Loading...</span></span>
        </div>
    </div>
    
    <!-- Email Statistics Card -->
    <div class="card">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Email Statistics</h2>
        
        <div class="grid grid-cols-1 gap-4 mb-6">
            <!-- Emails Sent -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-blue-400 to-blue-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Emails Sent</p>
                    <p class="text-lg font-semibold text-gray-800" id="total-emails-sent">0</p>
                </div>
            </div>
            
            <!-- Replies Received -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-green-400 to-green-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Replies Received</p>
                    <p class="text-lg font-semibold text-gray-800" id="replies-received">0</p>
                </div>
            </div>
            
            <!-- Reply Rate -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-purple-400 to-purple-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4a1 1 0 10-2 0v6a1 1 0 102 0V7zm-3 2a1 1 0 10-2 0v4a1 1 0 102 0V9zm-3 3a1 1 0 10-2 0v1a1 1 0 102 0v-1z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Reply Rate</p>
                    <p class="text-lg font-semibold" id="reply-rate">0%</p>
                </div>
            </div>
        </div>
        
        <!-- Reply Rate Chart Placeholder -->
        <div class="bg-gray-100 rounded-lg p-4 flex items-center justify-center h-40">
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <p class="text-gray-500 text-sm">Reply rate over time chart</p>
            </div>
        </div>
    </div>
    
    <!-- Email Sequence Card -->
    <div class="card">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Email Sequence</h2>
        
        <div class="grid grid-cols-1 gap-4 mb-6">
            <!-- Initial Emails -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-blue-400 to-blue-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Initial Emails</p>
                    <p class="text-lg font-semibold text-gray-800" id="initial-emails">0</p>
                </div>
            </div>
            
            <!-- Follow-up Emails -->
            <div class="flex items-center">
                <div class="p-2 rounded-lg bg-gradient-to-br from-purple-400 to-purple-600 text-white mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Follow-up Emails</p>
                    <p class="text-lg font-semibold text-gray-800" id="followup-emails">0</p>
                </div>
            </div>
        </div>
        
        <!-- Email Sequence Timeline -->
        <div class="space-y-4">
            <div class="flex items-start">
                <div class="flex-shrink-0 h-5 w-5 rounded-full bg-blue-500 flex items-center justify-center mt-1">
                    <span class="text-xs text-white font-bold">1</span>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-gray-800">Initial Email</h3>
                    <p class="text-xs text-gray-500">Sent immediately after contact extraction</p>
                </div>
            </div>
            
            <div class="flex items-start">
                <div class="flex-shrink-0 h-5 w-5 rounded-full bg-purple-500 flex items-center justify-center mt-1">
                    <span class="text-xs text-white font-bold">2</span>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-gray-800">Follow-up #1</h3>
                    <p class="text-xs text-gray-500">Sent 3 days after initial email</p>
                </div>
            </div>
            
            <div class="flex items-start">
                <div class="flex-shrink-0 h-5 w-5 rounded-full bg-purple-500 flex items-center justify-center mt-1">
                    <span class="text-xs text-white font-bold">3</span>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-gray-800">Follow-up #2</h3>
                    <p class="text-xs text-gray-500">Sent 5 days after follow-up #1</p>
                </div>
            </div>
            
            <div class="flex items-start">
                <div class="flex-shrink-0 h-5 w-5 rounded-full bg-purple-500 flex items-center justify-center mt-1">
                    <span class="text-xs text-white font-bold">4</span>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-gray-800">Follow-up #3</h3>
                    <p class="text-xs text-gray-500">Sent 7 days after follow-up #2</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Status Card -->
<div class="card mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Email Status</h2>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <!-- Pending Emails -->
        <div class="flex flex-col items-center p-4 bg-gray-50 rounded-lg">
            <div class="p-3 rounded-full bg-gray-200 text-gray-600 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <p class="text-sm text-gray-500 mb-1">Pending</p>
            <p class="text-xl font-bold text-gray-800" id="pending-emails">0</p>
        </div>
        
        <!-- Sent Emails -->
        <div class="flex flex-col items-center p-4 bg-blue-50 rounded-lg">
            <div class="p-3 rounded-full bg-blue-200 text-blue-600 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <p class="text-sm text-gray-500 mb-1">Sent</p>
            <p class="text-xl font-bold text-gray-800" id="sent-emails">0</p>
        </div>
        
        <!-- Replied Emails -->
        <div class="flex flex-col items-center p-4 bg-green-50 rounded-lg">
            <div class="p-3 rounded-full bg-green-200 text-green-600 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
            </div>
            <p class="text-sm text-gray-500 mb-1">Replied</p>
            <p class="text-xl font-bold text-gray-800" id="replied-emails">0</p>
        </div>
        
        <!-- Failed Emails -->
        <div class="flex flex-col items-center p-4 bg-red-50 rounded-lg">
            <div class="p-3 rounded-full bg-red-200 text-red-600 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <p class="text-sm text-gray-500 mb-1">Failed</p>
            <p class="text-xl font-bold text-gray-800" id="failed-emails">0</p>
        </div>
    </div>
</div>

<!-- Apps Table Card -->
<div class="card mb-8">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Apps</h2>
        <div class="flex flex-col sm:flex-row gap-3">
            <!-- Search Input -->
            <div class="relative">
                <input type="text" id="search-input" placeholder="Search apps..." class="input-field pl-10 py-2">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
            
            <!-- Status Filter -->
            <div class="relative">
                <select id="status-filter" class="input-field pr-10 py-2">
                    <option value="all">All Statuses</option>
                    <option value="has_contacts">Has Contacts</option>
                    <option value="no_contacts">No Contacts</option>
                    <option value="email_generated">Email Generated</option>
                    <option value="email_sent">Email Sent</option>
                    <option value="email_replied">Email Replied</option>
                    <option value="email_failed">Email Failed</option>
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>
            
            <!-- Export Button -->
            <button id="export-csv" class="btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Export CSV
            </button>
        </div>
    </div>
    
    <!-- Apps Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">App Name</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact Status</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email Generation</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email Status</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="apps-table-body">
                <!-- Table rows will be populated by JavaScript -->
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">Loading app data...</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Pagination Controls -->
    <div class="flex flex-col sm:flex-row items-center justify-between mt-6">
        <div class="text-sm text-gray-700 mb-4 sm:mb-0">
            Showing <span id="showing-items">0-0</span> of <span id="total-items">0</span> apps
        </div>
        <div class="flex items-center space-x-2">
            <button id="prev-page" class="btn-secondary py-1 px-3 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
            </button>
            <button id="next-page" class="btn-secondary py-1 px-3 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- Email Preview Modal -->
<div id="email-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-primary-600 to-primary-800 text-white px-6 py-4 rounded-t-xl flex items-center justify-between">
            <h3 class="text-xl font-bold" id="modal-app-name">App Name</h3>
            <button id="close-modal" class="text-white hover:text-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <!-- Modal Content -->
        <div class="p-6">
            <!-- Email Subject -->
            <div class="mb-6">
                <h4 class="text-sm font-medium text-gray-500 mb-1">Subject</h4>
                <p class="text-lg font-medium text-gray-800" id="email-subject"></p>
            </div>
            
            <!-- Email Tracking Status -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h4 class="text-sm font-medium text-gray-500 mb-3">Email Tracking Status</h4>
                <div class="flex flex-wrap gap-4" id="email-tracking-status">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Initial Email -->
            <div class="mb-6">
                <div class="flex items-center mb-3">
                    <div class="p-1.5 rounded-full bg-blue-100 text-blue-600 mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                        </svg>
                    </div>
                    <h4 class="text-md font-semibold text-gray-800">Initial Email</h4>
                </div>
                <div class="border border-gray-200 rounded-lg p-4 bg-white">
                    <div id="initial-email-content" class="prose max-w-none"></div>
                </div>
            </div>
            
            <!-- Follow-up Emails -->
            <div id="followup-emails-container">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Alert Toast -->
<div id="alert-toast" class="fixed bottom-4 right-4 z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-4 max-w-md flex items-center">
        <div id="alert-icon" class="flex-shrink-0 mr-3">
            <!-- Icon will be added by JavaScript -->
        </div>
        <div>
            <p id="alert-message" class="text-sm font-medium"></p>
        </div>
        <button id="close-alert" class="ml-auto text-gray-400 hover:text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Define variables
    let currentPage = 1;
    const itemsPerPage = 10;
    let filteredApps = [];
    let allApps = [];
    let searchTerm = '';
    let statusFilter = 'all';
    let refreshInterval;
    let campaignId = window.location.pathname.split('/').pop();
    
    // Status colors for badges
    const statusColors = {
        'replied': 'badge-green',
        'sent': 'badge-blue',
        'failed': 'badge-red',
        'pending': 'badge-yellow',
        'generated': 'badge-purple',
        'none': 'badge',
        'completed': 'badge-green',
        'email_sending': 'badge-blue',
        'followups_active': 'badge-purple',
        'uploaded': 'badge-yellow',
        'extraction_done': 'badge-yellow',
        'generating_emails': 'badge-purple',
        'emails_generated': 'badge-purple'
    };
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Set campaign ID in the header
        document.getElementById('campaign-id').textContent = campaignId;
        
        // Fetch initial campaign data
        fetchCampaignData();
        
        // Set up refresh interval (every 30 seconds)
        refreshInterval = setInterval(fetchCampaignData, 30000);
        
        // Set up event listeners
        document.getElementById('refresh-data').addEventListener('click', function() {
            fetchCampaignData();
            showAlert('Data refreshed successfully', 'success');
        });
        
        document.getElementById('search-input').addEventListener('input', function() {
            searchTerm = this.value.toLowerCase();
            applyFilters();
        });
        
        document.getElementById('status-filter').addEventListener('change', function() {
            statusFilter = this.value;
            applyFilters();
        });
        
        document.getElementById('prev-page').addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                renderAppsTable();
            }
        });
        
        document.getElementById('next-page').addEventListener('click', function() {
            const maxPage = Math.ceil(filteredApps.length / itemsPerPage);
            if (currentPage < maxPage) {
                currentPage++;
                renderAppsTable();
            }
        });
        
        document.getElementById('export-csv').addEventListener('click', exportToCSV);
        
        // Modal close events
        document.getElementById('close-modal').addEventListener('click', closeModalWithAnimation);
        
        document.getElementById('email-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModalWithAnimation();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModalWithAnimation();
            }
        });
        
        // Alert close event
        document.getElementById('close-alert').addEventListener('click', function() {
            document.getElementById('alert-toast').classList.add('hidden');
        });
        
        // Set up event delegation for view email buttons
        document.getElementById('apps-table-body').addEventListener('click', function(e) {
            const viewEmailButton = e.target.closest('.view-email');
            if (viewEmailButton) {
                const appId = viewEmailButton.getAttribute('data-app-id');
                openEmailModal(parseInt(appId));
            }
        });
    });
    
    // Function to fetch campaign data
    function fetchCampaignData() {
        fetch(`/campaign/${campaignId}/apps`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                updateCampaignDetails(data.campaign);
                allApps = data.apps;
                applyFilters();
            })
            .catch(error => {
                console.error('Error fetching campaign data:', error);
                showAlert('Failed to fetch campaign data. Please try again.', 'error');
            });
    }
    
    // Function to update campaign details
    function updateCampaignDetails(campaign) {
        // Update campaign status badge
        const statusBadge = document.getElementById('campaign-status-badge');
        statusBadge.className = statusColors[campaign.status] || 'badge';
        statusBadge.textContent = campaign.status.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        
        // Update campaign stats
        document.getElementById('total-apps').textContent = campaign.total_apps;
        document.getElementById('apps-with-contacts').textContent = campaign.apps_with_contacts;
        document.getElementById('emails-generated').textContent = campaign.emails_generated;
        document.getElementById('emails-sent').textContent = campaign.emails_sent;
        
        // Update progress bars
        document.getElementById('extraction-percentage').textContent = campaign.extraction_percentage + '%';
        document.getElementById('generation-percentage').textContent = campaign.generation_percentage + '%';
        document.getElementById('sending-percentage').textContent = campaign.sending_percentage + '%';
        
        document.getElementById('extraction-progress').style.width = campaign.extraction_percentage + '%';
        document.getElementById('generation-progress').style.width = campaign.generation_percentage + '%';
        document.getElementById('sending-progress').style.width = campaign.sending_percentage + '%';
        
        // Update email statistics
        document.getElementById('total-emails-sent').textContent = campaign.total_emails_sent;
        document.getElementById('replies-received').textContent = campaign.replies_received;
        
        // Update reply rate with color coding
        const replyRateElement = document.getElementById('reply-rate');
        const replyRate = campaign.reply_rate;
        replyRateElement.textContent = replyRate + '%';
        
        if (replyRate >= 15) {
            replyRateElement.className = 'text-lg font-semibold text-green-600';
        } else if (replyRate >= 5) {
            replyRateElement.className = 'text-lg font-semibold text-yellow-600';
        } else {
            replyRateElement.className = 'text-lg font-semibold text-red-600';
        }
        
        // Update email sequence stats
        document.getElementById('initial-emails').textContent = campaign.initial_emails_sent;
        document.getElementById('followup-emails').textContent = campaign.total_followups_sent;
        
        // Update email status counts
        document.getElementById('pending-emails').textContent = campaign.pending_emails;
        document.getElementById('sent-emails').textContent = campaign.sent_emails;
        document.getElementById('replied-emails').textContent = campaign.replied_emails;
        document.getElementById('failed-emails').textContent = campaign.failed_emails;
        
        // Update last updated timestamp
        document.getElementById('last-updated').textContent = new Date().toLocaleString();
    }
    
    // Function to apply filters
    function applyFilters() {
        filteredApps = allApps.filter(app => {
            // Apply search filter
            const matchesSearch = app.name.toLowerCase().includes(searchTerm);
            
            // Apply status filter
            let matchesStatus = true;
            if (statusFilter === 'has_contacts') {
                matchesStatus = app.contact_status === 'has_contacts';
            } else if (statusFilter === 'no_contacts') {
                matchesStatus = app.contact_status === 'no_contacts';
            } else if (statusFilter === 'email_generated') {
                matchesStatus = app.email_generated;
            } else if (statusFilter === 'email_sent') {
                matchesStatus = app.email_status === 'sent';
            } else if (statusFilter === 'email_replied') {
                matchesStatus = app.email_status === 'replied';
            } else if (statusFilter === 'email_failed') {
                matchesStatus = app.email_status === 'failed';
            }
            
            return matchesSearch && matchesStatus;
        });
        
        // Reset to first page when filters change
        currentPage = 1;
        
        // Update pagination info
        updatePagination();
        
        // Render the table
        renderAppsTable();
    }
    
    // Function to update pagination controls
    function updatePagination() {
        const totalItems = filteredApps.length;
        const maxPage = Math.ceil(totalItems / itemsPerPage);
        const start = (currentPage - 1) * itemsPerPage + 1;
        const end = Math.min(start + itemsPerPage - 1, totalItems);
        
        document.getElementById('showing-items').textContent = totalItems > 0 ? `${start}-${end}` : '0-0';
        document.getElementById('total-items').textContent = totalItems;
        
        // Update button states
        document.getElementById('prev-page').disabled = currentPage <= 1;
        document.getElementById('next-page').disabled = currentPage >= maxPage;
    }
    
    // Function to render the apps table
    function renderAppsTable() {
        const tableBody = document.getElementById('apps-table-body');
        tableBody.innerHTML = '';
        
        if (filteredApps.length === 0) {
            // No apps found message
            const noAppsRow = document.createElement('tr');
            noAppsRow.innerHTML = `
                <td colspan="6" class="px-6 py-10 text-center">
                    <div class="flex flex-col items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="text-gray-600 mb-4">No apps found</p>
                        <button id="reset-filters" class="btn-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                            </svg>
                            Reset filters
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(noAppsRow);
            
            // Add event listener to reset filters button
            setTimeout(() => {
                const resetButton = document.getElementById('reset-filters');
                if (resetButton) {
                    resetButton.addEventListener('click', function() {
                        document.getElementById('search-input').value = '';
                        document.getElementById('status-filter').value = 'all';
                        searchTerm = '';
                        statusFilter = 'all';
                        applyFilters();
                    });
                }
            }, 0);
            
            return;
        }
        
        // Calculate slice for current page
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const currentPageApps = filteredApps.slice(startIndex, endIndex);
        
        // Create table rows
        currentPageApps.forEach((app, index) => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors duration-150';
            
            // Calculate the actual index in the filtered list
            const displayIndex = startIndex + index + 1;
            
            // Contact status badge
            let contactStatusBadge;
            if (app.contact_status === 'has_contacts') {
                contactStatusBadge = `<span class="badge-green">${app.contacts_count} Contacts</span>`;
            } else {
                contactStatusBadge = `<span class="badge">None</span>`;
            }
            
            // Email generation badge
            let emailGenerationBadge;
            if (app.email_generated) {
                emailGenerationBadge = `<span class="badge-purple">Generated</span>`;
            } else if (app.contact_status === 'has_contacts') {
                emailGenerationBadge = `<span class="badge-yellow">Pending</span>`;
            } else {
                emailGenerationBadge = `<span class="badge">N/A</span>`;
            }
            
            // Email status badge
            let emailStatusBadge;
            if (app.email_status === 'replied') {
                emailStatusBadge = `<span class="badge-green">Replied</span>`;
            } else if (app.email_status === 'sent') {
                emailStatusBadge = `<span class="badge-blue">Sent</span>`;
            } else if (app.email_status === 'failed') {
                emailStatusBadge = `<span class="badge-red">Failed</span>`;
            } else if (app.email_generated) {
                emailStatusBadge = `<span class="badge-yellow">Pending</span>`;
            } else {
                emailStatusBadge = `<span class="badge">N/A</span>`;
            }
            
            // View email button
            let viewEmailButton = '';
            if (app.email_generated) {
                viewEmailButton = `
                    <button class="text-primary-600 hover:text-primary-800 view-email" data-app-id="${app.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
            }
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${displayIndex}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">${app.name}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">${contactStatusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap">${emailGenerationBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap">${emailStatusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">${viewEmailButton}</td>
            `;
            
            tableBody.appendChild(row);
        });
    }
    
    // Function to open email modal
    function openEmailModal(appId) {
        const app = allApps.find(a => a.id === appId);
        if (!app) return;
        
        // Set app name and email subject
        document.getElementById('modal-app-name').textContent = app.name;
        document.getElementById('email-subject').textContent = app.email_subject;
        
        // Set email tracking status
        const trackingContainer = document.getElementById('email-tracking-status');
        trackingContainer.innerHTML = '';
        
        // Initial email status
        const initialStatus = app.email_tracking.initial;
        trackingContainer.innerHTML += `
            <div class="flex items-center">
                <div class="p-1.5 rounded-full ${getStatusBgColor(initialStatus)} ${getStatusTextColor(initialStatus)} mr-2">
                    ${getStatusIcon(initialStatus)}
                </div>
                <div>
                    <p class="text-xs text-gray-500">Initial Email</p>
                    <p class="text-sm font-medium">${formatStatus(initialStatus)}</p>
                </div>
            </div>
        `;
        
        // Followup email statuses
        ['followup1', 'followup2', 'followup3'].forEach((key, index) => {
            const status = app.email_tracking[key];
            if (status) {
                trackingContainer.innerHTML += `
                    <div class="flex items-center">
                        <div class="p-1.5 rounded-full ${getStatusBgColor(status)} ${getStatusTextColor(status)} mr-2">
                            ${getStatusIcon(status)}
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Follow-up #${index + 1}</p>
                            <p class="text-sm font-medium">${formatStatus(status)}</p>
                        </div>
                    </div>
                `;
            }
        });
        
        // Set initial email content
        document.getElementById('initial-email-content').innerHTML = app.initial_email;
        
        // Set followup emails content
        const followupContainer = document.getElementById('followup-emails-container');
        followupContainer.innerHTML = '';
        
        app.followup_emails.forEach((email, index) => {
            followupContainer.innerHTML += `
                <div class="mb-6">
                    <div class="flex items-center mb-3">
                        <div class="p-1.5 rounded-full bg-purple-100 text-purple-600 mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                                <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z" />
                            </svg>
                        </div>
                        <h4 class="text-md font-semibold text-gray-800">Follow-up #${index + 1}</h4>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 bg-white">
                        <div class="prose max-w-none">${email}</div>
                    </div>
                </div>
            `;
        });
        
        // Show the modal
        const modal = document.getElementById('email-modal');
        modal.classList.remove('hidden');
        modal.classList.add('animate-fade-in');
    }
    
    // Function to close modal with animation
    function closeModalWithAnimation() {
        const modal = document.getElementById('email-modal');
        modal.classList.add('animate-fade-out');
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('animate-fade-out', 'animate-fade-in');
        }, 300);
    }
    
    // Helper functions for email status
    function getStatusBgColor(status) {
        switch(status) {
            case 'sent': return 'bg-blue-100';
            case 'replied': return 'bg-green-100';
            case 'failed': return 'bg-red-100';
            case 'pending': return 'bg-yellow-100';
            default: return 'bg-gray-100';
        }
    }
    
    function getStatusTextColor(status) {
        switch(status) {
            case 'sent': return 'text-blue-600';
            case 'replied': return 'text-green-600';
            case 'failed': return 'text-red-600';
            case 'pending': return 'text-yellow-600';
            default: return 'text-gray-600';
        }
    }
    
    function getStatusIcon(status) {
        switch(status) {
            case 'sent':
                return `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>`;
            case 'replied':
                return `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>`;
            case 'failed':
                return `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>`;
            case 'pending':
                return `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>`;
            default:
                return `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>`;
        }
    }
    
    function formatStatus(status) {
        return status.charAt(0).toUpperCase() + status.slice(1);
    }
    
    // Function to export apps data to CSV
    function exportToCSV() {
        // Define CSV headers
        const headers = ['App Name', 'Contact Status', 'Contacts Count', 'Email Generated', 'Email Status'];
        
        // Convert filtered apps to CSV rows
        const rows = filteredApps.map(app => [
            app.name,
            app.contact_status === 'has_contacts' ? 'Has Contacts' : 'No Contacts',
            app.contacts_count || 0,
            app.email_generated ? 'Yes' : 'No',
            formatStatus(app.email_status || 'none')
        ]);
        
        // Combine headers and rows
        const csvContent = [
            headers.join(','),
            ...rows.map(row => row.join(','))
        ].join('\n');
        
        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `campaign_${campaignId}_apps.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showAlert('CSV file exported successfully', 'success');
    }
    
    // Function to show alert toast
    function showAlert(message, type) {
        const alertToast = document.getElementById('alert-toast');
        const alertMessage = document.getElementById('alert-message');
        const alertIcon = document.getElementById('alert-icon');
        
        // Set message
        alertMessage.textContent = message;
        
        // Set icon and colors based on type
        if (type === 'success') {
            alertMessage.className = 'text-sm font-medium text-green-800';
            alertIcon.innerHTML = `
                <div class="p-1.5 rounded-full bg-green-100 text-green-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                </div>
            `;
            alertToast.className = 'fixed bottom-4 right-4 z-50 bg-green-50 rounded-lg shadow-lg p-4 max-w-md flex items-center animate-slide-up';
        } else {
            alertMessage.className = 'text-sm font-medium text-red-800';
            alertIcon.innerHTML = `
                <div class="p-1.5 rounded-full bg-red-100 text-red-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                </div>
            `;
            alertToast.className = 'fixed bottom-4 right-4 z-50 bg-red-50 rounded-lg shadow-lg p-4 max-w-md flex items-center animate-slide-up';
        }
        
        // Show the alert
        alertToast.classList.remove('hidden');
        
        // Hide after 3 seconds
        setTimeout(() => {
            alertToast.classList.add('animate-slide-down');
            setTimeout(() => {
                alertToast.classList.add('hidden');
                alertToast.classList.remove('animate-slide-down', 'animate-slide-up');
            }, 300);
        }, 3000);
    }
</script>

<style>
    /* Animation classes */
    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    .animate-fade-out {
        animation: fadeOut 0.3s ease-in-out;
    }
    
    .animate-slide-up {
        animation: slideUp 0.3s ease-in-out;
    }
    
    .animate-slide-down {
        animation: slideDown 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes slideDown {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(20px); opacity: 0; }
    }
</style>
{% endblock %}